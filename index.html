<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rulette - Card Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    .container { background: #fff; padding: 2rem 3rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
    h1 { margin-bottom: 1.5rem; }
    #login-btn, #logout-btn { padding: 0.7rem 1.5rem; font-size: 1rem; border: none; border-radius: 5px; background: #4285F4; color: #fff; cursor: pointer; margin-top: 1rem; }
    #logout-btn { background: #d9534f; }
    #user-info { margin-top: 1.5rem; }
    .turn-indicator {
      font-size: 1.5rem;
      color: #222;
      margin-bottom: 0.2em;
      text-align: center;
      line-height: 1;
      filter: drop-shadow(0 1px 2px #fff8);
    }
    .player-token {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      border: 2.5px solid #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.12);
      position: absolute;
      top: 8px;
      /* left is set dynamically for each token */
      transition: box-shadow 0.2s;
    }
    .progress-dots {
      display: flex;
      gap: 4px;
      margin-top: 5px;
    }
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #ccc; /* Default color for uncompleted progress */
      border: 1px solid #999;
    }
    .progress-dot.completed {
      background-color: #4CAF50; /* Color for completed progress */
    }
    
    /* Wheel Component Styles */
    #wheel-container {
      user-select: none;
    }
    
    #wheel {
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
      transition: all 0.15s ease-in-out;
    }
    
    #wheel.spinning {
      animation: flashColors 0.1s infinite;
    }
    
    @keyframes flashColors {
      0% { background-color: #FF6B6B; } /* Rule - Red */
      16.66% { background-color: #4ECDC4; } /* Prompt - Teal */
      33.33% { background-color: #45B7D1; } /* Modifier - Blue */
      50% { background-color: #96CEB4; } /* Clone - Green */
      66.66% { background-color: #FFEAA7; color: #333; } /* Flip - Yellow */
      83.33% { background-color: #DDA0DD; } /* Swap - Purple */
      100% { background-color: #FF6B6B; } /* Back to Rule - Red */
    }
    
    #wheel-text {
      transition: all 0.15s ease-in-out;
    }
    
    #wheel.spinning #wheel-text {
      animation: flashText 0.1s infinite;
    }
    
    @keyframes flashText {
      0% { content: "Rule"; }
      16.66% { content: "Prompt"; }
      33.33% { content: "Modifier"; }
      50% { content: "Clone"; }
      66.66% { content: "Flip"; }
      83.33% { content: "Swap"; }
      100% { content: "Rule"; }
    }
    
    #spin-wheel-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    
    #wheel-result {
      min-height: 1.5rem;
      transition: opacity 0.3s ease;
    }
    
    .wheel-result-highlight {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #333;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      display: inline-block;
      animation: resultPulse 0.6s ease-out;
    }
    
    @keyframes resultPulse {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* Prompt Card Visual Distinctions */
    .prompt-card-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: #4ECDC4;
      border-radius: 50%;
      color: white;
      font-weight: bold;
      font-size: 12px;
      margin-right: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .prompt-card-highlight {
      background: linear-gradient(135deg, #4ECDC4, #44A08D) !important;
      border: 2px solid #4ECDC4 !important;
      box-shadow: 0 0 10px rgba(78, 205, 196, 0.3) !important;
    }
    
    .prompt-status-indicator {
      display: inline-flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin: 5px 0;
    }
    
    .prompt-status-progress {
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #bbdefb;
    }
    
    .prompt-status-judging {
      background: #fff3e0;
      color: #f57c00;
      border: 1px solid #ffcc02;
    }
    
    .prompt-status-completed {
      background: #e8f5e8;
      color: #2e7d32;
      border: 1px solid #4caf50;
    }
    
    .prompt-status-failed {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #f44336;
    }
    
    /* Enhanced wheel segment styling for Prompt cards */
    #wheel .wheel-segment:nth-child(2) {
      position: relative;
    }
    
    #wheel .wheel-segment:nth-child(2)::before {
      content: "P";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 16px;
      height: 16px;
      background: rgba(255,255,255,0.9);
      color: #4ECDC4;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      margin-top: -20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    
    /* Active Rules Display Styles */
    .rule-item {
      background: #fff;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    .rule-item:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }
    
    .rule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .rule-title {
      font-weight: bold;
      font-size: 1.1rem;
      color: #495057;
      margin: 0;
    }
    
    .rule-owner {
      font-size: 0.9rem;
      color: #6c757d;
      font-style: italic;
    }
    
    .rule-description {
      color: #495057;
      margin: 0.5rem 0;
      line-height: 1.4;
    }
    
    .rule-metadata {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }
    
    .rule-type-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Rule Type Colors */
    .rule-type-persistent {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .rule-type-temporary {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .rule-type-transferable {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .rule-duration-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      background: #f8f9fa;
      color: #495057;
      border: 1px solid #dee2e6;
    }
    
    .rule-priority-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .rule-priority-low {
      background: #f8f9fa;
      color: #6c757d;
      border: 1px solid #dee2e6;
    }
    
    .rule-priority-normal {
      background: #e2e3e5;
      color: #495057;
      border: 1px solid #ced4da;
    }
    
    .rule-priority-high {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .rule-priority-critical {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .rule-state-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .rule-state-active {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .rule-state-suspended {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .rule-state-pending {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    /* Clone rule indicators */
    .rule-clone-indicator {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      background: #e7f3ff;
      color: #0066cc;
      border: 1px solid #b3d9ff;
    }
    
    .rule-clone-indicator::before {
      content: "üîó";
      margin-right: 4px;
    }
    
    /* Flip rule indicators */
    .rule-flip-indicator {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      background: #fff0e6;
      color: #cc6600;
      border: 1px solid #ffcc99;
    }
    
    .rule-flip-indicator::before {
      content: "üîÑ";
      margin-right: 4px;
    }
    
    /* Callout System Styles */
    #callout-panel {
      transition: all 0.3s ease;
    }
    
    #callout-player-select:disabled,
    #initiate-callout-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    #initiate-callout-btn:hover:not(:disabled) {
      background: #c82333;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    #callout-valid-btn:hover {
      background: #218838;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    #callout-invalid-btn:hover {
      background: #5a6268;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .callout-history-item {
      padding: 0.5rem;
      border-bottom: 1px solid #eee;
      font-size: 0.9rem;
    }
    
    .callout-history-item:last-child {
      border-bottom: none;
    }
    
    .callout-history-item.valid {
      background: #d4edda;
      border-left: 4px solid #28a745;
    }
    
    .callout-history-item.invalid {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
    }
    
    .callout-history-item.pending {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
    }
    
    #callout-cooldown-message {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    #active-callout {
      animation: pulseCallout 2s infinite;
    }
    
    @keyframes pulseCallout {
      0%, 100% { border-color: #ffd700; }
      50% { border-color: #ffed4e; }
    }
    
    /* Player Info Panel Styles */
    .player-card {
      background: #fff;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .player-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }
    
    .player-card.current-player {
      border-color: #28a745;
      background: linear-gradient(135deg, #f8fff9, #e8f5e8);
    }
    
    .player-card.referee {
      border-color: #ffc107;
      background: linear-gradient(135deg, #fffdf0, #fff3cd);
    }
    
    .player-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    .player-name {
      font-weight: bold;
      font-size: 1.1rem;
      color: #495057;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .player-badges {
      display: flex;
      gap: 0.25rem;
    }
    
    .player-badge {
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .badge-current {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .badge-referee {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .player-points {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    
    .points-display {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 2px 4px rgba(0,123,255,0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .points-display.points-changed {
      animation: pointsFlash 0.6s ease-out;
    }
    
    @keyframes pointsFlash {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); background: linear-gradient(135deg, #28a745, #1e7e34); }
      100% { transform: scale(1); }
    }
    
    .points-change-indicator {
      position: absolute;
      top: -20px;
      right: 10px;
      font-size: 0.9rem;
      font-weight: bold;
      color: #28a745;
      animation: flyUp 1s ease-out forwards;
      pointer-events: none;
    }
    
    .points-change-indicator.negative {
      color: #dc3545;
    }
    
    @keyframes flyUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-30px); }
    }
    
    .player-cards-section {
      margin-top: 0.75rem;
    }
    
    .cards-header {
      font-weight: bold;
      color: #6c757d;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .cards-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .card-item {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      color: #495057;
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
    }
    
    .card-item:hover {
      background: linear-gradient(135deg, #e9ecef, #dee2e6);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .card-item.card-transferred {
      animation: cardTransfer 0.8s ease-out;
    }
    
    @keyframes cardTransfer {
      0% { transform: scale(1) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.1) rotate(5deg); opacity: 0.7; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    .card-type-rule { border-left: 4px solid #FF6B6B; }
    .card-type-prompt { border-left: 4px solid #4ECDC4; }
    .card-type-modifier { border-left: 4px solid #45B7D1; }
    .card-type-clone { border-left: 4px solid #96CEB4; }
    .card-type-flip { border-left: 4px solid #FFEAA7; }
    .card-type-swap { border-left: 4px solid #DDA0DD; }
    
    .no-cards-message {
      color: #6c757d;
      font-style: italic;
      font-size: 0.9rem;
      text-align: center;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px dashed #dee2e6;
    }
    
    /* Enhanced player scores in header */
    .header-player-score {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 20px;
      border: 2px solid #dee2e6;
      transition: all 0.3s ease;
    }
    
    .header-player-score.current-player {
      border-color: #28a745;
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
    }
    
    .header-player-score.referee {
      border-color: #ffc107;
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
    }
    
    .header-score-name {
      font-weight: bold;
      color: #495057;
    }
    
    .header-score-points {
      background: #007bff;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-weight: bold;
      font-size: 0.9rem;
      min-width: 30px;
      text-align: center;
    }

    /* Host Controls - Kick Player Styles */
    .lobby-player-actions {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: center;
    }

    .kick-player-btn {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .kick-player-btn:hover {
      background: #c82333;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
    }

    .kick-player-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(220, 53, 69, 0.3);
    }

    .kick-player-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .kick-btn-icon {
      font-size: 0.9rem;
    }

    .kick-btn-text {
      font-size: 0.85rem;
    }

    /* Kick Confirmation Dialog Styles */
    .kick-confirmation-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
    }

    .kick-confirmation-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s ease;
    }

    .kick-confirmation-content {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease;
    }

    .kick-confirmation-content h3 {
      margin: 0 0 1rem 0;
      color: #dc3545;
      font-size: 1.3rem;
      text-align: center;
    }

    .kick-confirmation-content p {
      margin: 0 0 1rem 0;
      color: #333;
      line-height: 1.5;
      text-align: center;
    }

    .kick-warning {
      color: #856404 !important;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 0.9rem;
    }

    .kick-confirmation-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      justify-content: center;
    }

    .kick-confirm-btn, .kick-cancel-btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s ease;
      min-width: 100px;
      justify-content: center;
    }

    .kick-confirm-btn {
      background: #dc3545;
      color: white;
    }

    .kick-confirm-btn:hover {
      background: #c82333;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3);
    }

    .kick-cancel-btn {
      background: #6c757d;
      color: white;
    }

    .kick-cancel-btn:hover {
      background: #5a6268;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(108, 117, 125, 0.3);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Mobile responsive adjustments for kick functionality */
    @media (max-width: 768px) {
      .kick-confirmation-content {
        padding: 1.5rem;
        margin: 1rem;
      }

      .kick-confirmation-actions {
        flex-direction: column;
        gap: 0.75rem;
      }

      .kick-confirm-btn, .kick-cancel-btn {
        width: 100%;
      }

      .kick-player-btn {
        padding: 0.35rem 0.7rem;
        font-size: 0.8rem;
      }
    }
    }
  </style>
</head>
<body>
  <div id="main-menu" class="container">
    <h1>Welcome to Rulette</h1>
    <p style="font-size: 1.1rem; color: #333; margin-bottom: 1.5rem; font-style: italic; line-height: 1.4; max-width: 600px; text-align: center;">
      A fast-paced card game where rules change with every spin!
    </p>
    
    <!-- Player Name Input -->
    <div id="player-setup" style="margin-bottom: 2rem;">
      <input type="text" id="player-name-input" placeholder="Enter your display name"
             style="padding: 0.7rem; font-size: 1rem; border: 2px solid #ddd; border-radius: 5px; margin-bottom: 1rem; width: 250px;">
    </div>
    
    <!-- Game Options -->
    <div id="game-options" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
      <button id="create-game-btn" style="padding: 0.7rem 1.5rem; font-size: 1rem; border: none; border-radius: 5px; background: #4285F4; color: #fff; cursor: pointer;">
        Create New Game
      </button>
      <button id="join-game-btn" style="padding: 0.7rem 1.5rem; font-size: 1rem; border: none; border-radius: 5px; background: #28a745; color: #fff; cursor: pointer;">
        Join Game
      </button>
    </div>
    
    <!-- Join Game Form (initially hidden) -->
    <div id="join-game-form" style="display:none; margin-top:1.5rem;">
      <input type="text" id="join-game-code" placeholder="Enter 6-character game code" maxlength="6"
             style="padding: 0.7rem; font-size: 1rem; border: 2px solid #ddd; border-radius: 5px; margin-right: 0.5rem; text-transform: uppercase;">
      <button id="submit-join-game-btn" style="padding: 0.7rem 1rem; font-size: 1rem; border: none; border-radius: 5px; background: #28a745; color: #fff; cursor: pointer;">
        Join
      </button>
      <span id="join-game-error" style="color:red; margin-left:0.5rem; display: block; margin-top: 0.5rem;"></span>
    </div>
  </div>
  <!-- Game Page Section (initially hidden) -->
  <div id="game-page" style="display:none; margin-top:2rem;">
    <div id="game-header" style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem;">
      <div id="game-join-code" style="font-size:1.2rem; font-weight:bold; color:#4285F4;"></div>
      <div id="players-scores" style="display:flex; gap:2rem;"></div>
      <div style="display:flex; gap:1rem; align-items:center;">
        <button id="terminate-session-btn" style="background:#dc3545; color:#fff; border:none; border-radius:5px; padding:0.5rem 1.2rem; font-size:1rem; cursor:pointer; display:none;" title="End session for all players">üõë End Session</button>
        <button id="game-logout-btn" style="background:#d9534f; color:#fff; border:none; border-radius:5px; padding:0.5rem 1.2rem; font-size:1rem; cursor:pointer;">Logout</button>
      </div>
    </div>

    <!-- Session Termination Confirmation Modal -->
    <div id="session-termination-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center;">
      <div style="background:#fff; border-radius:12px; padding:2rem; max-width:500px; width:90%; box-shadow:0 10px 30px rgba(0,0,0,0.3); text-align:center; position:relative;">
        <div style="font-size:3rem; margin-bottom:1rem;">‚ö†Ô∏è</div>
        <h3 style="color:#dc3545; margin-bottom:1rem; font-size:1.5rem;">End Session</h3>
        <p style="color:#666; margin-bottom:1.5rem; line-height:1.5;">
          Are you sure you want to end this session? This will terminate the game for all players and cannot be undone.
        </p>
        
        <div style="margin-bottom:1.5rem;">
          <label for="termination-reason" style="display:block; margin-bottom:0.5rem; font-weight:bold; color:#333;">Reason (optional):</label>
          <input type="text" id="termination-reason" placeholder="e.g., Technical issues, Game completed early..."
                 style="width:100%; padding:0.75rem; border:1px solid #ddd; border-radius:6px; font-size:1rem;">
        </div>
        
        <div style="display:flex; gap:1rem; justify-content:center;">
          <button id="confirm-terminate-btn" style="background:#dc3545; color:#fff; border:none; border-radius:6px; padding:0.75rem 1.5rem; font-size:1rem; cursor:pointer; font-weight:bold;">
            End Session
          </button>
          <button id="cancel-terminate-btn" style="background:#6c757d; color:#fff; border:none; border-radius:6px; padding:0.75rem 1.5rem; font-size:1rem; cursor:pointer; font-weight:bold;">
            Cancel
          </button>
        </div>
      </div>
    </div>
    
    <!-- Player Cards and Points Display Panel -->
    <div id="player-info-panel" style="display:none; margin-bottom:1.5rem; padding:1rem; background:#f8f9fa; border:2px solid #dee2e6; border-radius:10px;">
      <h3 style="margin-top:0; margin-bottom:1rem; color:#495057; display:flex; align-items:center;">
        <span style="margin-right:0.5rem;">üë•</span>
        Player Status
      </h3>
      <div id="player-cards-container" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:1rem;">
        <!-- Player cards will be dynamically populated here -->
      </div>
    </div>
    <!-- Dev Turn Order Override (only visible for dev/test users) -->
    <div id="dev-turn-order-controls" style="display:none; margin-top:1rem; padding:1rem; background:#d1ecf1; border:2px solid #bee5eb; border-radius:8px; text-align:center;">
      <div style="font-weight:bold; color:#0c5460; margin-bottom:0.5rem;">üõ†Ô∏è DEV MODE: Turn Order Override</div>
      <div style="margin-bottom:0.5rem;">
        <label for="dev-turn-roll1" style="margin-right:0.5rem;">Host Roll Die 1 (1-6):</label>
        <input type="number" id="dev-turn-roll1" min="1" max="6" style="width:50px; padding:0.2rem; margin-right:1rem;">
        <label for="dev-turn-roll2" style="margin-right:0.5rem;">Host Roll Die 2 (1-6):</label>
        <input type="number" id="dev-turn-roll2" min="1" max="6" style="width:50px; padding:0.2rem;">
      </div>
      <div style="font-size:0.9rem; color:#0c5460;">Leave empty for random rolls. Only affects host's turn order roll.</div>
    </div>
    <button id="start-game-btn" style="display:none; background:#28a745; color:#fff; border:none; border-radius:5px; padding:0.5rem 1.2rem; font-size:1rem; cursor:pointer;">Start Game</button>
    <div id="turn-order" style="margin-top:1rem; font-weight:bold;"></div>
    
    <!-- Turn Management UI -->
    <div id="turn-management" style="display:none; margin-top:1.5rem; padding:1rem; background:#e8f5e8; border:2px solid #28a745; border-radius:8px; text-align:center;">
      <div id="current-turn-indicator" style="font-size:1.3rem; font-weight:bold; color:#155724; margin-bottom:0.5rem;">
        <span id="current-player-name">Player Name</span>'s Turn
      </div>
      <div id="turn-info" style="font-size:0.9rem; color:#155724; margin-bottom:1rem;">
        Turn <span id="current-turn-number">1</span> of 10
      </div>
      <div id="turn-actions" style="margin-top:1rem;">
        <div id="waiting-message" style="display:none; color:#6c757d; font-style:italic;">
          Waiting for <span id="waiting-player-name">Player</span> to take their turn...
        </div>
        <div id="your-turn-message" style="display:none; color:#155724; font-weight:bold;">
          It's your turn! Spin the wheel to draw a card.
        </div>
      </div>
    </div>
    
    <!-- Callout Mechanism UI -->
    <div id="callout-panel" style="display:none; margin-top:1.5rem; padding:1rem; background:#fff8dc; border:2px solid #ffd700; border-radius:8px;">
      <h3 style="margin-top:0; margin-bottom:1rem; color:#b8860b; display:flex; align-items:center;">
        <span style="margin-right:0.5rem;">‚öñÔ∏è</span>
        Callout System
      </h3>
      
      <!-- Callout Initiation (for players) -->
      <div id="callout-initiation" style="margin-bottom:1rem;">
        <div style="margin-bottom:0.5rem; font-weight:bold; color:#b8860b;">Call out a player for rule violation:</div>
        <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
          <select id="callout-player-select" style="padding:0.5rem; border:1px solid #ddd; border-radius:4px; background:#fff;">
            <option value="">Select player to call out...</option>
          </select>
          <input type="text" id="callout-reason" placeholder="Rule violated (optional)" style="padding:0.5rem; border:1px solid #ddd; border-radius:4px; flex:1; min-width:200px;">
          <button id="initiate-callout-btn" style="background:#dc3545; color:#fff; border:none; border-radius:5px; padding:0.5rem 1rem; cursor:pointer; font-weight:bold;">Call Out</button>
        </div>
        <div id="callout-cooldown-message" style="display:none; margin-top:0.5rem; color:#dc3545; font-size:0.9rem; font-style:italic;"></div>
      </div>
      
      <!-- Active Callout Display -->
      <div id="active-callout" style="display:none; margin-bottom:1rem; padding:1rem; background:#fff; border:2px solid #ffd700; border-radius:6px;">
        <div style="font-weight:bold; color:#b8860b; margin-bottom:0.5rem;">üö® Active Callout</div>
        <div id="callout-details" style="margin-bottom:0.5rem;"></div>
        <div id="callout-status" style="font-style:italic; color:#666;"></div>
      </div>
      
      <!-- Referee Adjudication (only visible to referee) -->
      <div id="referee-adjudication" style="display:none; padding:1rem; background:#e8f5e8; border:2px solid #28a745; border-radius:6px;">
        <div style="font-weight:bold; color:#155724; margin-bottom:1rem;">üë®‚Äç‚öñÔ∏è Referee Decision Required</div>
        <div id="referee-callout-details" style="margin-bottom:1rem; padding:0.5rem; background:#fff; border-radius:4px;"></div>
        <div style="display:flex; gap:1rem; justify-content:center;">
          <button id="callout-valid-btn" style="background:#28a745; color:#fff; border:none; border-radius:5px; padding:0.7rem 1.5rem; cursor:pointer; font-weight:bold;">Valid Callout</button>
          <button id="callout-invalid-btn" style="background:#6c757d; color:#fff; border:none; border-radius:5px; padding:0.7rem 1.5rem; cursor:pointer; font-weight:bold;">Invalid Callout</button>
        </div>
      </div>
      
      <!-- Card Transfer UI (only visible to caller after valid callout) -->
      <div id="card-transfer-panel" style="display:none; margin-bottom:1rem; padding:1rem; background:#e8f4fd; border:2px solid #007bff; border-radius:6px;">
        <div style="font-weight:bold; color:#004085; margin-bottom:1rem;">üé¥ Card Transfer Available</div>
        <div style="margin-bottom:0.5rem; color:#004085;">You may transfer one of your cards to the accused player:</div>
        <div id="card-transfer-details" style="margin-bottom:1rem; padding:0.5rem; background:#fff; border-radius:4px; font-size:0.9rem;"></div>
        
        <div style="margin-bottom:1rem;">
          <label for="card-transfer-select" style="display:block; margin-bottom:0.5rem; font-weight:bold; color:#004085;">Select a card to transfer:</label>
          <select id="card-transfer-select" style="padding:0.5rem; border:1px solid #007bff; border-radius:4px; background:#fff; width:100%; max-width:400px;">
            <option value="">Choose a card...</option>
          </select>
        </div>
        
        <div style="display:flex; gap:1rem; justify-content:center;">
          <button id="confirm-card-transfer-btn" style="background:#007bff; color:#fff; border:none; border-radius:5px; padding:0.7rem 1.5rem; cursor:pointer; font-weight:bold;" disabled>Transfer Card</button>
          <button id="skip-card-transfer-btn" style="background:#6c757d; color:#fff; border:none; border-radius:5px; padding:0.7rem 1.5rem; cursor:pointer; font-weight:bold;">Skip Transfer</button>
        </div>
      </div>
      
      <!-- Callout History -->
      <div id="callout-history" style="margin-top:1rem;">
        <div style="font-weight:bold; color:#b8860b; margin-bottom:0.5rem; cursor:pointer;" onclick="toggleCalloutHistory()">
          üìú Callout History <span id="history-toggle">‚ñº</span>
        </div>
        <div id="callout-history-list" style="display:none; max-height:150px; overflow-y:auto; background:#fff; border:1px solid #ddd; border-radius:4px; padding:0.5rem;">
          <div id="no-callout-history" style="text-align:center; color:#666; font-style:italic;">No callouts yet</div>
        </div>
      </div>
    </div>
    
    <!-- Dev Dice Roll Override (only visible for dev/test users) -->
    <div id="dev-dice-controls" style="display:none; margin-top:1rem; padding:1rem; background:#fff3cd; border:2px solid #ffeaa7; border-radius:8px; text-align:center;">
      <div style="font-weight:bold; color:#856404; margin-bottom:0.5rem;">üõ†Ô∏è DEV MODE: Dice Roll Override</div>
      <div style="margin-bottom:0.5rem;">
        <label for="dev-roll1" style="margin-right:0.5rem;">Die 1 (1-6):</label>
        <input type="number" id="dev-roll1" min="1" max="6" style="width:50px; padding:0.2rem; margin-right:1rem;">
        <label for="dev-roll2" style="margin-right:0.5rem;">Die 2 (1-6):</label>
        <input type="number" id="dev-roll2" min="1" max="6" style="width:50px; padding:0.2rem;">
      </div>
      <div style="font-size:0.9rem; color:#856404;">Leave empty for random rolls</div>
    </div>
    <!-- Wheel Component -->
    <div id="wheel-container" style="display:none; margin:2rem auto; text-align:center;">
      <div id="wheel-wrapper" style="position:relative; width:300px; height:150px; margin:0 auto;">
        <div id="wheel" style="width:100%; height:100%; border-radius:10px; position:relative; border:4px solid #333; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold; color:white; text-shadow:2px 2px 4px rgba(0,0,0,0.8); background:#FF6B6B;">
          <!-- Flashing box content will be updated by JavaScript -->
          <span id="wheel-text">Rule</span>
        </div>
      </div>
      <button id="spin-wheel-btn" style="background:#28a745; color:#fff; border:none; border-radius:5px; padding:0.7rem 1.5rem; font-size:1.1rem; cursor:pointer; margin-top:1.5rem;" disabled>Spin Wheel</button>
      <div id="wheel-result" style="margin-top:1rem; font-weight:bold; font-size:1.2rem; color:#333;"></div>
      <!-- Active Rules Display Panel -->
      <div id="active-rules-panel" style="margin-top:2rem; padding:1.5rem; background:#f8f9fa; border:2px solid #dee2e6; border-radius:10px; display:none;">
        <h3 style="margin-top:0; margin-bottom:1rem; color:#495057; display:flex; align-items:center;">
          <span style="margin-right:0.5rem;">üìã</span>
          Active Rules
          <span id="rules-count-badge" style="background:#6c757d; color:white; border-radius:12px; padding:2px 8px; font-size:0.8rem; margin-left:0.5rem;">0</span>
        </h3>
        <div id="active-rules-container">
          <div id="no-rules-message" style="text-align:center; color:#6c757d; font-style:italic; padding:1rem;">
            No active rules yet. Draw cards to activate rules!
          </div>
        </div>
      </div>
    </div>
    
    
    <!-- Test buttons for card draw mechanism -->
    <div id="test-buttons" style="margin-top:2rem; padding:1rem; background:#f8f9fa; border-radius:8px; text-align:center;">
      <h4>Test Card Draw Mechanism</h4>
      <button onclick="window.testCardDraw('Rule')" style="background:#FF6B6B; color:#fff; border:none; border-radius:5px; padding:0.5rem 1rem; margin:0.25rem; cursor:pointer;">Test Rule Card</button>
      <button onclick="window.testCardDraw('Prompt')" style="background:#4ECDC4; color:#fff; border:none; border-radius:5px; padding:0.5rem 1rem; margin:0.25rem; cursor:pointer;">Test Prompt Card</button>
      <button onclick="window.testCardDraw('Modifier')" style="background:#45B7D1; color:#fff; border:none; border-radius:5px; padding:0.5rem 1rem; margin:0.25rem; cursor:pointer;">Test Modifier Card</button>
      <button onclick="window.testWheel()" style="background:#28a745; color:#fff; border:none; border-radius:5px; padding:0.5rem 1rem; margin:0.25rem; cursor:pointer;">Test Wheel + Card Draw</button>
    </div>
  </div>
  
  <script>
    // Toggle callout history visibility
    function toggleCalloutHistory() {
      const historyList = document.getElementById('callout-history-list');
      const toggle = document.getElementById('history-toggle');
      
      if (historyList.style.display === 'none') {
        historyList.style.display = 'block';
        toggle.textContent = '‚ñ≤';
      } else {
        historyList.style.display = 'none';
        toggle.textContent = '‚ñº';
      }
    }
  </script>
  
  <script type="module" src="./firebase-init.js"></script>
  <script type="module" src="./main.js"></script>
  <!-- Game Card Popup Modal -->
  <div id="game-card-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2rem; border-radius:1rem; max-width:400px; margin:auto; box-shadow:0 2px 16px rgba(0,0,0,0.3); position:relative;">
      <h3 id="game-card-title" style="margin-top:0;"></h3>
      <h2 id="game-card-question"></h2>
      <div id="game-card-choices"></div>
      <div id="game-card-result" style="margin-top:1rem; font-weight:bold;"></div>
    </div>
  </div>
  <!-- Notification Modal -->
  <div id="notification-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2rem; border-radius:1rem; max-width:400px; margin:auto; box-shadow:0 2px 16px rgba(0,0,0,0.3); position:relative;">
      <h2 id="notification-title">Notification</h2>
      <p id="notification-message"></p>
      <button id="notification-close-btn" style="background:#007bff; color:#fff; border:none; border-radius:5px; padding:0.5rem 1.2rem; font-size:1rem; cursor:pointer; margin-top:1rem;">OK</button>
    </div>
  </div>
  
  <!-- End Game Modal -->
  <div id="end-game-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:1001; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2.5rem; border-radius:1rem; max-width:600px; width:90%; margin:auto; box-shadow:0 4px 20px rgba(0,0,0,0.4); position:relative; text-align:center;">
      <!-- Game Over Header -->
      <div id="end-game-header" style="margin-bottom:2rem;">
        <h1 id="end-game-title" style="margin:0; font-size:2.5rem; color:#333;">üéâ Game Over!</h1>
        <p id="end-game-reason" style="margin:0.5rem 0 0 0; font-size:1.2rem; color:#666;"></p>
      </div>
      
      <!-- Winner Announcement -->
      <div id="winner-section" style="margin-bottom:2rem; display:none;">
        <div style="background:linear-gradient(135deg, #ffd700, #ffed4e); padding:1.5rem; border-radius:10px; margin-bottom:1rem;">
          <h2 style="margin:0; font-size:2rem; color:#333;">üëë Winner</h2>
          <p id="winner-name" style="margin:0.5rem 0 0 0; font-size:1.5rem; font-weight:bold; color:#333;"></p>
          <p id="winner-points" style="margin:0.25rem 0 0 0; font-size:1.1rem; color:#666;"></p>
        </div>
      </div>
      
      <!-- Final Standings -->
      <div id="standings-section" style="margin-bottom:2rem;">
        <h3 style="margin:0 0 1rem 0; font-size:1.5rem; color:#333;">üìä Final Standings</h3>
        <div id="standings-list" style="background:#f8f9fa; border-radius:8px; padding:1rem;">
          <!-- Standings will be populated by JavaScript -->
        </div>
      </div>
      
      <!-- Game Statistics -->
      <div id="game-stats" style="margin-bottom:2rem; display:none;">
        <h4 style="margin:0 0 0.5rem 0; color:#666;">Game Statistics</h4>
        <div style="display:flex; justify-content:space-around; text-align:center; font-size:0.9rem; color:#666;">
          <div>
            <div style="font-weight:bold;" id="game-duration">--</div>
            <div>Duration</div>
          </div>
          <div>
            <div style="font-weight:bold;" id="total-callouts">--</div>
            <div>Callouts</div>
          </div>
          <div>
            <div style="font-weight:bold;" id="cards-played">--</div>
            <div>Cards Played</div>
          </div>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;">
        <button id="restart-game-btn" style="background:#28a745; color:#fff; border:none; border-radius:8px; padding:0.8rem 1.5rem; font-size:1.1rem; cursor:pointer; font-weight:bold; transition:background 0.2s;">
          üîÑ Play Again
        </button>
        <button id="return-lobby-btn" style="background:#007bff; color:#fff; border:none; border-radius:8px; padding:0.8rem 1.5rem; font-size:1.1rem; cursor:pointer; font-weight:bold; transition:background 0.2s;">
          üè† Return to Lobby
        </button>
        <button id="view-history-btn" style="background:#6c757d; color:#fff; border:none; border-radius:8px; padding:0.8rem 1.5rem; font-size:1.1rem; cursor:pointer; font-weight:bold; transition:background 0.2s;">
          üìú View Game History
        </button>
      </div>
      
      <!-- Close Button -->
      <button id="close-end-game-btn" style="position:absolute; top:1rem; right:1rem; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#999; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background 0.2s;" title="Close">
        ‚úï
      </button>
    </div>
  </div>

  <!-- Session Management Modal -->
  <div id="session-modal" class="modal" style="display: none;">
    <div class="modal-content session-modal-content">
      <div class="modal-header">
        <h2 id="session-modal-title">Multiplayer Session</h2>
        <span class="close" id="session-modal-close">&times;</span>
      </div>
      
      <div class="modal-body">
        <!-- Session Creation Panel -->
        <div id="create-session-panel" class="session-panel">
          <h3>Create New Session</h3>
          <p>Start a new multiplayer game and invite friends to join!</p>
          
          <div class="session-form">
            <div class="form-group">
              <label for="host-display-name">Your Display Name:</label>
              <input type="text" id="host-display-name" placeholder="Enter your name" maxlength="20">
            </div>
            
            <div class="form-group">
              <label for="max-players">Maximum Players:</label>
              <select id="max-players">
                <option value="2">2 Players</option>
                <option value="3">3 Players</option>
                <option value="4">4 Players</option>
                <option value="5">5 Players</option>
                <option value="6" selected>6 Players</option>
              </select>
            </div>
            
            <button id="create-session-btn" class="session-btn primary">Create Session</button>
          </div>
          
          <!-- Session Created Success -->
          <div id="session-created-info" class="session-info" style="display: none;">
            <h4>üéâ Session Created Successfully!</h4>
            <div class="session-details">
              <div class="session-code-display">
                <label>Share this code with friends:</label>
                <div class="code-container">
                  <span id="session-code-text" class="session-code"></span>
                  <button id="copy-code-btn" class="copy-btn" title="Copy to clipboard">üìã</button>
                </div>
              </div>
              
              <div class="session-link-display">
                <label>Or share this link:</label>
                <div class="link-container">
                  <input type="text" id="session-link-text" class="session-link" readonly>
                  <button id="copy-link-btn" class="copy-btn" title="Copy to clipboard">üìã</button>
                </div>
              </div>
              
              <div class="session-actions">
                <button id="start-lobby-btn" class="session-btn primary">Go to Lobby</button>
                <button id="create-another-btn" class="session-btn secondary">Create Another</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Session Join Panel -->
        <div id="join-session-panel" class="session-panel" style="display: none;">
          <h3>Join Existing Session</h3>
          <p>Enter a session code to join a friend's game!</p>
          
          <div class="session-form">
            <div class="form-group">
              <label for="player-display-name">Your Display Name:</label>
              <input type="text" id="player-display-name" placeholder="Enter your name" maxlength="20">
            </div>
            
            <div class="form-group">
              <label for="session-code-input">Session Code:</label>
              <input type="text" id="session-code-input" placeholder="Enter 6-character code" maxlength="6" style="text-transform: uppercase;">
              <small class="form-help">Enter the 6-character code shared by your friend</small>
            </div>
            
            <button id="join-session-btn" class="session-btn primary">Join Session</button>
          </div>
          
          <!-- Join Status -->
          <div id="join-status" class="session-status" style="display: none;">
            <div id="join-loading" class="loading-spinner" style="display: none;">
              <div class="spinner"></div>
              <span>Joining session...</span>
            </div>
            <div id="join-success" class="status-success" style="display: none;">
              <h4>‚úÖ Successfully Joined!</h4>
              <p>Welcome to the session. Redirecting to lobby...</p>
            </div>
            <div id="join-error" class="status-error" style="display: none;">
              <h4>‚ùå Failed to Join</h4>
              <p id="join-error-message">Please check the session code and try again.</p>
              <button id="retry-join-btn" class="session-btn secondary">Try Again</button>
            </div>
          </div>
        </div>
        
        <!-- Panel Toggle -->
        <div class="panel-toggle">
          <button id="show-create-panel" class="toggle-btn active">Create Session</button>
          <button id="show-join-panel" class="toggle-btn">Join Session</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Management Styles -->
  <style>
    /* Modal Styles */
    .modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .session-modal-content {
      background: #fff;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid #e9ecef;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px 12px 0 0;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.5rem;
    }

    .close {
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      color: white;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .close:hover {
      opacity: 1;
    }

    .modal-body {
      padding: 2rem;
    }

    /* Session Panel Styles */
    .session-panel {
      margin-bottom: 2rem;
    }

    .session-panel h3 {
      color: #495057;
      margin-bottom: 0.5rem;
    }

    .session-panel p {
      color: #6c757d;
      margin-bottom: 1.5rem;
    }

    /* Form Styles */
    .session-form {
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #495057;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-help {
      display: block;
      margin-top: 0.25rem;
      font-size: 0.875rem;
      color: #6c757d;
    }

    /* Button Styles */
    .session-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .session-btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .session-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .session-btn.secondary {
      background: #f8f9fa;
      color: #495057;
      border: 2px solid #e9ecef;
    }

    .session-btn.secondary:hover {
      background: #e9ecef;
    }

    .session-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Session Info Styles */
    .session-info {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 1.5rem;
    }

    .session-info h4 {
      color: #155724;
      margin-bottom: 1rem;
    }

    .session-details {
      margin-top: 1rem;
    }

    .session-code-display,
    .session-link-display {
      margin-bottom: 1rem;
    }

    .session-code-display label,
    .session-link-display label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #155724;
    }

    .code-container,
    .link-container {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .session-code {
      background: #fff;
      border: 2px solid #c3e6cb;
      border-radius: 6px;
      padding: 0.75rem 1rem;
      font-family: 'Courier New', monospace;
      font-size: 1.25rem;
      font-weight: bold;
      letter-spacing: 2px;
      color: #155724;
      flex: 1;
      text-align: center;
    }

    .session-link {
      background: #fff;
      border: 2px solid #c3e6cb;
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 0.875rem;
      color: #155724;
      flex: 1;
    }

    .copy-btn {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.75rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s;
    }

    .copy-btn:hover {
      background: #218838;
    }

    .session-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .session-actions .session-btn {
      flex: 1;
    }

    /* Panel Toggle Styles */
    .panel-toggle {
      display: flex;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 0.25rem;
      margin-top: 2rem;
    }

    .toggle-btn {
      flex: 1;
      padding: 0.75rem;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .toggle-btn.active {
      background: white;
      color: #667eea;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Status Styles */
    .session-status {
      margin-top: 1rem;
    }

    .loading-spinner {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: #e3f2fd;
      border-radius: 8px;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #e3f2fd;
      border-top: 2px solid #2196f3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status-success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 1rem;
    }

    .status-success h4 {
      color: #155724;
      margin-bottom: 0.5rem;
    }

    .status-success p {
      color: #155724;
      margin: 0;
    }

    .status-error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 8px;
      padding: 1rem;
    }

    .status-error h4 {
      color: #721c24;
      margin-bottom: 0.5rem;
    }

    .status-error p {
      color: #721c24;
      margin-bottom: 1rem;
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      .session-modal-content {
        width: 95%;
        margin: 1rem;
      }

      .modal-body {
        padding: 1rem;
      }

      .session-actions {
        flex-direction: column;
      }

      .code-container,
      .link-container {
        flex-direction: column;
      }

      .session-code,
      .session-link {
        text-align: center;
      }
    }

    /* Lobby UI Styles */
    #lobby-container {
      display: none;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .lobby-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e9ecef;
    }

    .lobby-title {
      font-size: 2rem;
      color: #495057;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .session-info {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .session-detail {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    .session-detail-label {
      font-size: 0.8rem;
      color: #6c757d;
      text-transform: uppercase;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }

    .session-detail-value {
      font-size: 1.1rem;
      color: #495057;
      font-weight: bold;
    }

    .players-section {
      margin-top: 2rem;
    }

    .players-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e9ecef;
    }

    .players-title {
      font-size: 1.5rem;
      color: #495057;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .players-count {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: bold;
    }

    .refresh-players-btn {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .refresh-players-btn:hover {
      background: #218838;
      transform: translateY(-1px);
    }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .lobby-player-card {
      background: #fff;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .lobby-player-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }

    .lobby-player-card.host {
      border-color: #ffc107;
      background: linear-gradient(135deg, #fffdf0, #fff3cd);
    }

    .lobby-player-card.referee {
      border-color: #17a2b8;
      background: linear-gradient(135deg, #f0fdff, #d1ecf1);
    }

    .lobby-player-card.active {
      border-color: #28a745;
      background: linear-gradient(135deg, #f8fff9, #e8f5e8);
    }

    .lobby-player-card.disconnected {
      border-color: #dc3545;
      background: linear-gradient(135deg, #fff5f5, #f8d7da);
      opacity: 0.8;
    }

    .lobby-player-card.left {
      border-color: #6c757d;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      opacity: 0.6;
    }

    .lobby-player-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .lobby-player-name {
      font-size: 1.2rem;
      font-weight: bold;
      color: #495057;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .lobby-player-badges {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      align-items: flex-end;
    }

    .lobby-player-badge {
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: bold;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .badge-host {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .badge-referee {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .badge-active {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .badge-disconnected {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .badge-left {
      background: #e2e3e5;
      color: #383d41;
      border: 1px solid #d6d8db;
    }

    .lobby-player-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
    }

    .status-indicator.active {
      background: #28a745;
      animation: pulse 2s infinite;
    }

    .status-indicator.disconnected {
      background: #dc3545;
    }

    .status-indicator.left {
      background: #6c757d;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-text {
      font-size: 0.9rem;
      color: #6c757d;
      font-weight: 500;
    }

    .lobby-player-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #e9ecef;
    }

    .lobby-player-detail {
      text-align: center;
    }

    .lobby-player-detail-label {
      font-size: 0.7rem;
      color: #6c757d;
      text-transform: uppercase;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }

    .lobby-player-detail-value {
      font-size: 1rem;
      color: #495057;
      font-weight: bold;
    }

    .connection-info {
      font-size: 0.8rem;
      color: #6c757d;
      margin-top: 0.5rem;
      text-align: center;
      padding-top: 0.5rem;
      border-top: 1px solid #f1f3f4;
    }

    .last-seen {
      font-style: italic;
    }

    .empty-lobby {
      text-align: center;
      padding: 3rem 2rem;
      color: #6c757d;
    }

    .empty-lobby-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-lobby-text {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .empty-lobby-subtext {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    /* Responsive Design for Lobby */
    @media (max-width: 768px) {
      #lobby-container {
        margin: 1rem;
        padding: 1rem;
      }

      .session-info {
        flex-direction: column;
        gap: 1rem;
      }

      .players-grid {
        grid-template-columns: 1fr;
      }

      .lobby-player-details {
        grid-template-columns: 1fr;
      }

      .players-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
      }
    }

    /* Simplified Host Controls Styles */
    .host-controls-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      border: 1px solid #dee2e6;
    }

    .host-actions {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .start-game-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 200px;
      justify-content: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
    }

    .start-game-btn:hover {
      background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
    }

    .start-game-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .start-game-btn:disabled:hover {
      background: #6c757d;
      transform: none;
      box-shadow: none;
    }

    .start-game-btn-icon {
      font-size: 1.2rem;
    }

    /* Responsive Design for Host Controls */
    @media (max-width: 768px) {
      .host-controls-section {
        margin-top: 1.5rem;
        padding: 1rem;
      }

      .start-game-btn {
        min-width: 100%;
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
      }
    }
  </style>

  <!-- Lobby Container -->
  <div id="lobby-container">
    <div class="lobby-header">
      <h1 class="lobby-title">
        üè† Game Lobby
      </h1>
      <div class="session-info">
        <div class="session-detail">
          <div class="session-detail-label">Session Code</div>
          <div class="session-detail-value" id="lobby-session-code">------</div>
        </div>
        <div class="session-detail">
          <div class="session-detail-label">Session State</div>
          <div class="session-detail-value" id="lobby-session-state">Lobby</div>
        </div>
        <div class="session-detail">
          <div class="session-detail-label">Max Players</div>
          <div class="session-detail-value" id="lobby-max-players">6</div>
        </div>
      </div>
    </div>

    <div class="players-section">
      <div class="players-header">
        <h2 class="players-title">
          üë• Players
          <span class="players-count" id="lobby-players-count">0/6</span>
        </h2>
        <button class="refresh-players-btn" id="refresh-lobby-btn">
          üîÑ Refresh
        </button>
      </div>

      <div class="players-grid" id="lobby-players-grid">
        <!-- Player cards will be dynamically inserted here -->
      </div>

      <div class="empty-lobby" id="empty-lobby-message" style="display: none;">
        <div class="empty-lobby-icon">üë•</div>
        <div class="empty-lobby-text">No players in the lobby</div>
        <div class="empty-lobby-subtext">Waiting for players to join...</div>
      </div>
    </div>

    <!-- Simplified Host Controls Section -->
    <div class="host-controls-section">
      <div class="host-actions">
        <!-- Start Game Button for Host -->
        <button class="start-game-btn" id="host-start-game-btn" style="display: none;">
          <span class="start-game-btn-icon">üöÄ</span>
          <span class="start-game-btn-text">Start Game</span>
        </button>
      </div>
    </div>
  </div>

</body>
</html>