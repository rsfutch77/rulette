rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // file version v0.3

    // =============================================================================
    // GAME SESSIONS COLLECTION
    // =============================================================================
    match /gameSessions/{sessionId} {
      // Allow create, read, and write if totalTransactions is less than 1000
      allow create, read, write: if get(/databases/$(database)/documents/serverTransactionTracking/tracking).data.totalTransactions < 10000;
    }
    
    // =============================================================================
    // PLAYERS COLLECTION
    // =============================================================================
    match /players/{playerId} {
      // Allow create, read, and write if totalTransactions is less than 1000
      allow create, read, write: if get(/databases/$(database)/documents/serverTransactionTracking/tracking).data.totalTransactions < 10000;
    }

    // =============================================================================
    // DEFAULT DENY ALL
    // =============================================================================
    
    // Deny all other operations by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}